<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Despesa com Pessoal - Governo de Minas Gerais</title>
    
    <!-- ==================== ESTILOS E BIBLIOTECAS ==================== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        /* ==================== VARIﾃ〃EIS DE CORES ==================== */
        :root {
            --primary-dark: #29435A;
            --primary-darker: #132837;
            --accent-red: #B93C42;
            --accent-bright: #DB233F;
            --background-light: #EEEFF5;
            --success-green: #28a745;
            --warning-yellow: #ffc107;
            --info-blue: #17a2b8;
            --chart-purple: #6B5B95;
            --chart-gray: #6C7A89;
        }

        /* ==================== ESTILOS GERAIS ==================== */
        body {
            font-family: 'Montserrat', 'Segoe UI', sans-serif;
            background-color: var(--background-light);
            padding-bottom: 30px;
            height: auto !important;
            overflow: visible !important;
        }
        html {
            height: auto !important;
            overflow: visible !important;
        }

        /* ==================== HEADER ==================== */
        .main-header {
            background: linear-gradient(135deg, var(--primary-darker) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 10px;
            border-bottom: 4px solid var(--accent-red);
        }
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logo {
            width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-bright) 100%);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px;
        }
        .header-title {
            font-weight: 700; font-size: 22px; margin: 0;
        }
        .header-subtitle {
            font-size: 14px; opacity: 0.9; margin: 5px 0 0 0;
        }

        /* ==================== DATA ATUALIZAﾃﾃグ ==================== */
        .data-atualizacao-container {
            display: flex; justify-content: center; margin-bottom: 20px;
        }
        .data-atualizacao-box {
            background: white; border-radius: 8px; padding: 8px 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            display: flex; align-items: center; gap: 8px;
            font-size: 12px; color: var(--primary-dark); font-weight: 600;
        }
        .data-atualizacao-box i {
            color: var(--accent-red);
        }

        /* ==================== FILTROS ==================== */
        .filter-container {
            background: white; border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08); padding: 20px;
            margin-bottom: 20px; border-left: 5px solid var(--accent-red);
        }
        .filter-label {
            font-weight: 600; color: var(--primary-dark);
            font-size: 12px; text-transform: uppercase; letter-spacing: 0.3px;
            margin-bottom: 6px;
        }
        .form-control, .form-select {
            border: 2px solid #e9ecef; border-radius: 6px;
            padding: 10px 12px; font-size: 13px; height: 42px;
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--accent-red);
            box-shadow: 0 0 0 2px rgba(185,60,66,0.15);
        }

        /* ==================== BOTﾃ髭S ==================== */
        .btn-primary-custom {
            background: var(--accent-red);
            border: 2px solid var(--accent-red);
            padding: 10px 20px; font-weight: 600; border-radius: 6px;
            font-size: 13px; color: white; transition: all 0.3s ease;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .btn-primary-custom:hover {
            background: var(--primary-darker);
            border-color: var(--primary-darker);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(19,40,55,0.2);
            color: white;
        }
        .btn-secondary-custom, .btn-export, .btn-share {
            background: white;
            border: 2px solid var(--primary-darker);
            color: var(--primary-darker);
            padding: 8px 15px; font-weight: 600; border-radius: 6px;
            font-size: 12px; transition: all 0.3s ease;
            display: inline-flex; align-items: center; gap: 6px;
            text-decoration: none;
        }
        .btn-secondary-custom:hover, .btn-export:hover, .btn-share:hover {
            background: var(--primary-darker);
            border-color: var(--primary-darker);
            color: white; transform: translateY(-1px);
        }
        .btn-share .material-icons {
            font-size: 16px;
        }

        /* ==================== DROPDOWN DE COMPARTILHAMENTO ==================== */
        .share-dropdown {
            position: relative;
            display: inline-block;
        }
        .share-options {
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            display: none;
            min-width: 200px;
            padding: 8px 0;
            margin: 4px 0 0;
            background-color: white;
            border: 1px solid rgba(0,0,0,.15);
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0,0,0,.175);
        }
        .share-options.show {
            display: block;
        }
        .share-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            color: var(--primary-darker);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            width: 100%;
            border: none;
            background: none;
        }
        .share-option:hover {
            background-color: rgba(19,40,55,0.05);
            color: var(--accent-red);
        }
        .share-option .material-icons {
            font-size: 18px;
            color: var(--accent-red);
        }

        /* ==================== MENU DE NAVEGAﾃﾃグ ==================== */
        .nav-tabs-container {
            background: white; 
            border-radius: 10px; 
            padding: 12px;
            margin-bottom: 20px; 
            margin-top: 10px;
            overflow-x: auto; 
            scrollbar-width: thin;
        }
        .nav-tabs {
            border: none !important; 
            gap: 4px; 
            flex-wrap: nowrap;
            min-width: max-content; 
            margin-bottom: 0 !important;
        }
        .nav-tabs .nav-item {
            flex-shrink: 0;
        }
        .nav-tabs .nav-link {
            border: none !important; 
            border-radius: 6px !important;
            padding: 10px 15px !important; 
            font-weight: 600;
            color: var(--primary-dark) !important;
            font-size: 13px; 
            white-space: nowrap;
            display: inline-flex !important; 
            align-items: center;
            background: none !important;
        }
        .nav-tabs .nav-link:hover {
            background-color: rgba(19,40,55,0.05) !important;
            color: var(--accent-red) !important;
        }
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%) !important;
            color: white !important;
        }
        .nav-tabs .nav-link .material-icons {
            font-size: 16px !important; 
            margin-right: 8px !important;
        }
        .nav-tabs .nav-link.active .material-icons {
            color: white !important;
        }

        /* ==================== CARDS DE Mﾃ欝RICAS ==================== */
        .metric-card {
            background: white; border-radius: 10px; padding: 20px 15px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06); margin-bottom: 20px;
            border-top: 4px solid var(--accent-red); height: 100%;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 24px; font-weight: 700; color: var(--primary-dark);
            margin: 8px 0; line-height: 1;
        }
        .metric-label {
            font-size: 12px; color: var(--primary-darker);
            font-weight: 600; margin-bottom: 6px;
            text-transform: uppercase; letter-spacing: 0.3px;
        }
        .metric-change {
            font-size: 11px; font-weight: 600; padding: 3px 8px;
            border-radius: 15px; display: inline-block;
        }
        .metric-change.positive {
            background-color: rgba(40,167,69,0.1); color: var(--success-green);
        }
        .metric-change.warning {
            background-color: rgba(255,193,7,0.1); color: var(--warning-yellow);
        }

        /* ==================== GRﾃ：ICOS ==================== */
        .chart-container {
            background: white; border-radius: 10px; padding: 15px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06); margin-bottom: 20px;
            height: 100%; min-height: 280px; border: 1px solid #dee2e6;
        }
        .chart-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; padding-bottom: 10px;
            border-bottom: 2px solid var(--background-light);
        }
        .chart-title {
            font-size: 16px; font-weight: 600; color: var(--primary-dark); margin: 0;
        }
        .chart-wrapper {
            position: relative; height: 220px; width: 100%;
        }

        /* ==================== TABELAS - SEM Tﾃ控ULO ==================== */
        .table-container {
            background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 3px 12px rgba(0,0,0,0.06); margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .table-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white; padding: 8px 15px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .table-badge {
            background: var(--accent-red); color: white;
            padding: 4px 12px; border-radius: 15px; font-size: 12px;
        }
        .table-fixed-header-container {
            max-height: 500px; overflow: auto;
        }
        .table {
            width: 100%; font-size: 13px; border-collapse: collapse;
            border: 1px solid #dee2e6;
        }
        .table thead th {
            background-color: var(--primary-dark) !important;
            color: white !important; font-weight: 600; padding: 12px 10px;
            font-size: 12px; text-transform: uppercase;
            border-left: 1px solid rgba(255,255,255,0.2);
            border-right: 1px solid rgba(255,255,255,0.2);
            position: sticky; top: 0; z-index: 20;
        }
        .table thead th:first-child { border-left: none; }
        .table thead th:last-child { border-right: none; }
        .table thead th:hover { background-color: var(--primary-darker) !important; }
        .table th, .table td {
            border: 1px solid #dee2e6; padding: 12px 10px; vertical-align: middle;
        }
        .table tbody tr:hover { background-color: rgba(41,67,90,0.04); }
        .valor-monetario { font-weight: 600; text-align: right; white-space: nowrap; }
        .valor-positivo { color: var(--success-green); }
        .valor-negativo { color: var(--accent-red); }
        .table-total-row { background-color: #f8f9fa !important; font-weight: 600; }

        /* ==================== CARDS DE LIMITES ==================== */
        .limite-card {
            text-align: center; padding: 15px; border-radius: 10px;
            background: white; box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: 1px solid #dee2e6;
        }
        .limite-card.safe { border-top: 4px solid var(--success-green); }
        .limite-card.warning { border-top: 4px solid var(--warning-yellow); }
        .limite-card.danger { border-top: 4px solid var(--accent-red); }
        .limite-card .porcentagem { font-size: 24px; font-weight: 700; margin: 8px 0; }
        .limite-card .valor { font-size: 20px; font-weight: 700; }
        .limite-card .label { font-size: 12px; color: var(--primary-darker); text-transform: uppercase; }

        /* ==================== BARRAS DE PROGRESSO ==================== */
        .progress-limite {
            height: 20px; border-radius: 10px; background-color: #e9ecef;
            overflow: hidden; margin-top: 5px; border: 1px solid #dee2e6;
        }
        .progress-bar-limite { height: 100%; transition: width 0.5s ease; }
        .progress-bar-limite.safe { background-color: var(--success-green); }
        .progress-bar-limite.warning { background-color: var(--warning-yellow); }
        .progress-bar-limite.danger { background-color: var(--accent-red); }
        .limite-info {
            display: flex; justify-content: space-between;
            font-size: 11px; margin-top: 3px; color: var(--primary-darker);
        }

        /* ==================== CARDS DE DOWNLOAD ==================== */
        .card-download {
            background: white; border-radius: 10px; padding: 20px;
            border: 1px solid #dee2e6; text-align: center;
            transition: all 0.3s ease; height: 100%;
        }
        .card-download:hover {
            transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }
        .card-download i { font-size: 48px; color: var(--primary-dark); margin-bottom: 15px; }
        .card-download h5 { font-weight: 600; color: var(--primary-dark); }
        .card-download p { font-size: 12px; color: #6c757d; margin-bottom: 15px; }

        /* ==================== LOADING ==================== */
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); display: flex;
            justify-content: center; align-items: center; z-index: 9999; display: none;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid rgba(19,40,55,0.1); border-radius: 50%;
            border-top-color: var(--accent-red); animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* ==================== FOOTER ==================== */
        .footer {
            background: white; padding: 30px 0; margin-top: 40px;
            border-top: 1px solid #dee2e6;
        }
        .footer a {
            color: var(--primary-dark); text-decoration: none; font-weight: 600;
        }
        .footer a:hover { color: var(--accent-red); text-decoration: underline; }

        /* ==================== RESPONSIVIDADE ==================== */
        @media (max-width: 768px) {
            .header-title { font-size: 18px; }
            .metric-value { font-size: 20px; }
            .chart-wrapper { height: 200px; }
        }

        /* ==================== CARDS DE DOWNLOAD E STATS PADRONIZADOS ==================== */
.card-download, .card-stats {
    background: white;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #dee2e6;
    text-align: center;
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
}

.card-download:hover, .card-stats:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    border-color: var(--primary-dark);
}

.card-download i.material-icons,
.card-stats i.material-icons {
    font-size: 48px !important;
    color: var(--primary-dark) !important;
    margin-bottom: 15px !important;
}

.card-download h4,
.card-download h5,
.card-stats h4,
.card-stats h5 {
    color: var(--primary-dark);
    font-weight: 600;
    margin-bottom: 10px;
    font-size: 18px;
}

.card-download p,
.card-stats p {
    font-size: 13px;
    color: #6c757d;
    margin-bottom: 20px;
    line-height: 1.5;
    flex-grow: 1;
}

/* ==================== BOTﾃグ EXPORT (PADRﾃグ) ==================== */
.btn-export {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    background: white !important;
    border: 2px solid var(--primary-darker) !important;
    color: var(--primary-darker) !important;
    padding: 10px 20px !important;
    border-radius: 6px !important;
    font-weight: 600 !important;
    font-size: 13px !important;
    text-decoration: none !important;
    transition: all 0.3s ease !important;
    cursor: pointer !important;
    width: 100%;
    max-width: 250px;
    margin: 0 auto !important;
}

.btn-export:hover {
    background: var(--primary-darker) !important;
    border-color: var(--primary-darker) !important;
    color: white !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 16px rgba(19, 40, 55, 0.25) !important;
}

.btn-export i.material-icons {
    font-size: 18px !important;
}

/* ==================== BADGE DE ARQUIVO ==================== */
.file-info-badge {
    background-color: #f8f9fa;
    padding: 8px 12px;
    border-radius: 4px;
    margin-bottom: 20px;
    font-family: monospace;
    font-size: 12px;
    color: var(--primary-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.file-info-badge i.material-icons {
    font-size: 14px !important;
    color: var(--primary-dark) !important;
    margin-bottom: 0 !important;
}

/* ==================== RESPONSIVIDADE ==================== */
@media (max-width: 768px) {
    .btn-export {
        max-width: 100%;
    }
    
    .card-download, .card-stats {
        padding: 20px;
    }
}
    </style>
</head>
<body>


    <div class="container">


        <!-- ==================== MENU DE NAVEGAﾃﾃグ ==================== -->
        <div class="nav-tabs-container">
            <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="dashboard1-tab" data-bs-toggle="tab" data-bs-target="#dashboard1" type="button" role="tab" aria-controls="dashboard1" aria-selected="true">
                        <i class="material-icons">bar_chart</i> Visﾃ｣o Geral
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="dashboard2-tab" data-bs-toggle="tab" data-bs-target="#dashboard2" type="button" role="tab" aria-controls="dashboard2" aria-selected="false">
                        <i class="material-icons">calendar_today</i> Evoluﾃｧﾃ｣o Mensal
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="dashboard3-tab" data-bs-toggle="tab" data-bs-target="#dashboard3" type="button" role="tab" aria-controls="dashboard3" aria-selected="false">
                        <i class="material-icons">balance</i> Limites da LRF
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="dashboard4-tab" data-bs-toggle="tab" data-bs-target="#dashboard4" type="button" role="tab" aria-controls="dashboard4" aria-selected="false">
                        <i class="material-icons">download</i> Downloads
                    </button>
                </li>
            </ul>
        </div>

        <!-- ==================== DATA DE ATUALIZAﾃﾃグ ==================== -->
        <div class="data-atualizacao-container">
            <div class="data-atualizacao-box">
                <i class="material-icons">update</i>
                Atualizado em: <span id="data-atualizacao-header">Carregando...</span>
            </div>
        </div>

        <div class="tab-content" id="dashboardTabsContent">
            <!-- ==================== DASHBOARD 1: VISﾃグ GERAL ==================== -->
            <div class="tab-pane fade show active" id="dashboard1" role="tabpanel" aria-labelledby="dashboard1-tab">
                <div class="filter-container">
                    <div class="row">
                        <div class="col-md-3 col-6">
                            <div class="mb-3">
                                <label for="anoDashboard1" class="filter-label">Ano</label>
                                <select class="form-select" id="anoDashboard1">
                                    <option value="">Carregando...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="mb-3">
                                <label for="periodoDashboard1" class="filter-label">Perﾃｭodo</label>
                                <select class="form-select" id="periodoDashboard1">
                                    <option value="anual">Anual</option>
                                    <option value="mensal" selected>Mensal</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-6" id="mesDashboard1Container">
                            <div class="mb-3">
                                <label for="mesDashboard1" class="filter-label">Mﾃｪs</label>
                                <select class="form-select" id="mesDashboard1">
                                    <option value="">Carregando...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="mb-3">
                                <label for="categoriaDashboard1" class="filter-label">Categoria</label>
                                <select class="form-select" id="categoriaDashboard1">
                                    <option value="total">Despesa Total</option>
                                    <option value="ativo">Pessoal Ativo</option>
                                    <option value="inativo">Inativos/Pensionistas</option>
                                    <option value="liquidada">Despesa Lﾃｭquida</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex gap-3 flex-wrap">
                                <button class="btn-primary-custom" id="aplicarFiltros">
                                    <i class="material-icons" style="font-size: 16px;">filter_alt</i> Aplicar Filtros
                                </button>
                                <button class="btn-secondary-custom" id="limparFiltros">
                                    <i class="material-icons" style="font-size: 16px;">restart_alt</i> Limpar Filtros
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4" id="summaryCards">
                    <div class="col-12 text-center">
                        <p class="text-muted">Carregando dados...</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6 col-12">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4 class="chart-title">Distribuiﾃｧﾃ｣o da Despesa</h4>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="chartDistribuicao"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-12">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4 class="chart-title">Despesa com Pessoal Ativo</h4>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="chartAtivoDetalhado"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="actions-container d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
                    <div class="export-buttons d-flex gap-2">
                        <button class="btn-export" id="exportCSVDashboard1">
                            <i class="material-icons" style="font-size: 16px;">file_download</i> Exportar CSV
                        </button>
                        <button class="btn-export" id="printDashboard1">
                            <i class="material-icons" style="font-size: 16px;">print</i> Imprimir
                        </button>
                        <div class="share-dropdown">
                            <button class="btn-share" id="shareButton1">
                                <i class="material-icons" style="font-size: 16px;">share</i> Compartilhar
                            </button>
                            <div class="share-options" id="shareOptions1">
                                <button class="share-option" onclick="copiarLink()">
                                    <i class="material-icons">link</i> Copiar Link
                                </button>
                                <button class="share-option" onclick="compartilharFacebook(event)">
                                    <i class="material-icons">facebook</i> Facebook
                                </button>
                                <button class="share-option" onclick="compartilharTwitter(event)">
                                    <i class="material-icons">X</i> Twitter
                                </button>
                                <button class="share-option" onclick="compartilharLinkedIn(event)">
                                    <i class="material-icons">linkedin</i> LinkedIn
                                </button>
                                <button class="share-option" onclick="compartilharWhatsApp(event)">
                                    <i class="material-icons">whatsapp</i> WhatsApp
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <span class="table-badge" id="resumoCountDashboard1">Carregando dados...</span>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="resumoTable">
                            <thead>
                                <tr>
                                    <th>Descriﾃｧﾃ｣o</th>
                                    <th class="text-end">Valor (R$)</th>
                                    <th class="text-end">% do Total</th>
                                    <th class="text-end">Mﾃｩdia Mensal</th>
                                </tr>
                            </thead>
                            <tbody id="resumoTableBody">
                                <tr><td colspan="4" class="text-center text-muted">Carregando dados...</td></tr>
                            </tbody>
                            <tfoot id="resumoTableFooter"></tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ==================== DASHBOARD 2: EVOLUﾃﾃグ MENSAL ==================== -->
            <div class="tab-pane fade" id="dashboard2" role="tabpanel" aria-labelledby="dashboard2-tab">
                <div class="filter-container">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="anoDashboard2" class="filter-label">Ano</label>
                                <select class="form-select" id="anoDashboard2">
                                    <option value="">Carregando...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="categoriaDashboard2" class="filter-label">Categoria</label>
                                <select class="form-select" id="categoriaDashboard2">
                                    <option value="total">Despesa Total</option>
                                    <option value="bruta">Despesa Bruta</option>
                                    <option value="liquida">Despesa Lﾃｭquida</option>
                                    <option value="ativo">Pessoal Ativo</option>
                                    <option value="inativo">Inativos/Pensionistas</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <button class="btn-primary-custom" id="aplicarFiltrosDashboard2">
                                <i class="material-icons" style="font-size: 16px;">filter_alt</i> Aplicar Filtros
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4 class="chart-title">Evoluﾃｧﾃ｣o Mensal da Despesa</h4>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="toggleAccumulated">
                                    <label class="form-check-label" for="toggleAccumulated" style="font-size: 12px;">
                                        Acumulado
                                    </label>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="chartEvolucao"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <span class="table-badge" id="resumoCountDashboard2">Carregando dados...</span>
                    </div>
                    <div class="table-fixed-header-container">
                        <table class="table" id="evolucaoTable">
                            <thead>
                                <tr>
                                    <th>Mﾃｪs</th>
                                    <th class="text-end">Despesa Bruta</th>
                                    <th class="text-end">Despesa Lﾃｭquida</th>
                                    <th class="text-end">Pessoal Ativo</th>
                                    <th class="text-end">Inativos/Pensionistas</th>
                                    <th class="text-end">Variaﾃｧﾃ｣o %</th>
                                </tr>
                            </thead>
                            <tbody id="evolucaoTableBody">
                                <tr><td colspan="6" class="text-center text-muted">Carregando dados...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ==================== DASHBOARD 3: LIMITES DA LRF ==================== -->
            <div class="tab-pane fade" id="dashboard3" role="tabpanel" aria-labelledby="dashboard3-tab">
                <div class="filter-container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="periodoLRF" class="filter-label">Perﾃｭodo de Apuraﾃｧﾃ｣o (12 meses)</label>
                                <select class="form-select" id="periodoLRF">
                                    <option value="">Carregando perﾃｭodos...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-4 col-12">
                        <div class="limite-card safe" id="limiteLegalCard">
                            <div class="label">LIMITE LEGAL</div>
                            <div class="porcentagem" id="limiteLegalPercentual">49.00%</div>
                            <div class="valor" id="limiteLegalValor">Carregando...</div>
                            <div class="limite-info">Mﾃ｡ximo permitido (LC 101/2000)</div>
                        </div>
                    </div>
                    <div class="col-md-4 col-12">
                        <div class="limite-card warning" id="limitePrudencialCard">
                            <div class="label">LIMITE PRUDENCIAL</div>
                            <div class="porcentagem" id="limitePrudencialPercentual">46.55%</div>
                            <div class="valor" id="limitePrudencialValor">Carregando...</div>
                            <div class="limite-info">95% do limite legal</div>
                        </div>
                    </div>
                    <div class="col-md-4 col-12">
                        <div class="limite-card danger" id="limiteAlertaCard">
                            <div class="label">LIMITE DE ALERTA</div>
                            <div class="porcentagem" id="limiteAlertaPercentual">44.10%</div>
                            <div class="valor" id="limiteAlertaValor">Carregando...</div>
                            <div class="limite-info">90% do limite legal</div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <div class="chart-header">
                                <h4 class="chart-title">Despesa com Pessoal vs. Receita Corrente Lﾃｭquida</h4>
                                <span class="badge" id="despesaAtualPercentual" style="background-color: var(--accent-red); color: white; padding: 6px 12px;">Carregando...</span>
                            </div>
                            <div class="p-4">
                                <div class="progress-limite">
                                    <div class="progress-bar-limite" id="progressBar" style="width: 0%;"></div>
                                </div>
                                <div class="limite-info mt-2">
                                    <span>0%</span>
                                    <span>Alerta: <span id="limiteAlertaValorLabel">44.10%</span></span>
                                    <span>Prudencial: <span id="limitePrudencialValorLabel">46.55%</span></span>
                                    <span>Legal: <span id="limiteLegalValorLabel">49.00%</span></span>
                                    <span>100%</span>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="filter-label">Receita Corrente Lﾃｭquida (RCL)</label>
                                            <div class="valor-monetario valor-positivo" id="rclTotal" style="font-size: 18px;">Carregando...</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="filter-label">Despesa Total com Pessoal (DTP)</label>
                                            <div class="valor-monetario" id="despesaExecutada" style="font-size: 18px;">Carregando...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <span>Apuraﾃｧﾃ｣o do Limite Legal - Detalhamento</span>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="limitesTable">
                            <thead>
                                <tr>
                                    <th>Descriﾃｧﾃ｣o</th>
                                    <th class="text-end">Valor (R$)</th>
                                    <th class="text-end">% da RCL</th>
                                </tr>
                            </thead>
                            <tbody id="limitesTableBody">
                                <tr><td colspan="3" class="text-center text-muted">Selecione um perﾃｭodo para visualizar os dados</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

   background: white;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #dee2e6;
    text-align: center;
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
}

.card-download:hover, .card-stats:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    border-color: var(--primary-dark);
}

.card-download i.material-icons,
.card-stats i.material-icons {
    font-size: 48px !important;
    color: var(--primary-dark) !important;
    margin-bottom: 15px !important;
}

.card-download h4,
.card-download h5,
.card-stats h4,
.card-stats h5 {
    color: var(--primary-dark);
    font-weight: 600;
    margin-bottom: 10px;
    font-size: 18px;
}

.card-download p,
.card-stats p {
    font-size: 13px;
    color: #6c757d;
    margin-bottom: 20px;
    line-height: 1.5;
    flex-grow: 1;
}

/* ==================== BOTﾃグ EXPORT (PADRﾃグ) ==================== */
.btn-export {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    background: white !important;
    border: 2px solid var(--primary-darker) !important;
    color: var(--primary-darker) !important;
    padding: 10px 20px !important;
    border-radius: 6px !important;
    font-weight: 600 !important;
    font-size: 13px !important;
    text-decoration: none !important;
    transition: all 0.3s ease !important;
    cursor: pointer !important;
    width: 100%;
    max-width: 250px;
    margin: 0 auto !important;
}

.btn-export:hover {
    background: var(--primary-darker) !important;
    border-color: var(--primary-darker) !important;
    color: white !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 16px rgba(19, 40, 55, 0.25) !important;
}

.btn-export i.material-icons {
    font-size: 18px !important;
}

/* ==================== BADGE DE ARQUIVO ==================== */
.file-info-badge {
    background-color: #f8f9fa;
    padding: 8px 12px;
    border-radius: 4px;
    margin-bottom: 20px;
    font-family: monospace;
    font-size: 12px;
    color: var(--primary-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.file-info-badge i.material-icons {
    font-size: 14px !important;
    color: var(--primary-dark) !important;
    margin-bottom: 0 !important;
}

/* ==================== RESPONSIVIDADE ==================== */
@media (max-width: 768px) {
    .btn-export {
        max-width: 100%;
    }
    
    .card-download, .card-stats {
        padding: 20px;
    }
}
塘 HTML COMPLETO DO DASHBOARD 4 (substitua completamente)
html
<!-- ==================== DASHBOARD 4: DOWNLOADS ==================== -->
<div class="tab-pane fade" id="dashboard4" role="tabpanel" aria-labelledby="dashboard4-tab">
    <div class="filter-container">
        
        <!-- === SEﾃﾃグ 1: DOWNLOAD DOS ARQUIVOS CSV === -->
        <div class="row mb-4">
            <div class="col-md-12">
                <h5 style="color: var(--primary-dark); font-weight: 600; margin-bottom: 5px;">
                    <i class="material-icons" style="vertical-align: middle; margin-right: 8px;">download</i>
                    Baixar Arquivos CSV Originais
                </h5>
                <p style="color: #6c757d; font-size: 13px; margin-bottom: 0;">
                    Arquivos disponﾃｭveis no repositﾃｳrio oficial de dados abertos
                </p>
            </div>
        </div>
        
        <!-- Cards de Download -->
        <div class="row mb-5">
            <!-- Card 1: Despesa Mensal -->
            <div class="col-md-6 mb-4">
                <div class="card-download">
                    <i class="material-icons">insert_chart</i>
                    <h5>Despesa Mensal com Pessoal</h5>
                    <p>Dados mensais detalhados de despesa bruta, lﾃｭquida, pessoal ativo, inativos, pensionistas e deduﾃｧﾃｵes.</p>
                    <div class="file-info-badge">
                        <i class="material-icons">insert_drive_file</i> 
                        despesa_pessoal_mensal.csv
                    </div>
                    <a href="https://raw.githubusercontent.com/transparencia-mg/despesa-pessoal-mg/main/dataset/data/despesa_pessoal_mensal.csv" 
                       class="btn-export" 
                       download>
                        <i class="material-icons">file_download</i> 
                        Baixar CSV
                    </a>
                </div>
            </div>
            
            <!-- Card 2: Limites LRF -->
            <div class="col-md-6 mb-4">
                <div class="card-download">
                    <i class="material-icons">balance</i>
                    <h5>Limites da Lei de Responsabilidade Fiscal</h5>
                    <p>Dados quadrimestrais da Receita Corrente Lﾃｭquida, despesa total com pessoal e apuraﾃｧﾃ｣o dos limites legais.</p>
                    <div class="file-info-badge">
                        <i class="material-icons">insert_drive_file</i> 
                        limites_lrf.csv
                    </div>
                    <a href="https://raw.githubusercontent.com/transparencia-mg/despesa-pessoal-mg/main/dataset/data/limites_lrf.csv" 
                       class="btn-export" 
                       download>
                        <i class="material-icons">file_download</i> 
                        Baixar CSV
                    </a>
                </div>
            </div>
        </div>

        <hr class="my-4" style="border-top: 1px solid #dee2e6;">

        <!-- === SEﾃﾃグ 2: INFORMAﾃﾃ髭S SOBRE OS DADOS === -->
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title" style="margin: 0; font-size: 16px;">Informaﾃｧﾃｵes sobre os Dados</h3>
            </div>
            <div class="p-4">
                <div class="row">
                    <!-- Card 3: Repositﾃｳrio GitHub -->
                    <div class="col-md-6 col-12 mb-4">
                        <div class="card-stats">
                            <i class="material-icons">code</i>
                            <h4>Repositﾃｳrio no GitHub</h4>
                            <p>Acesse o repositﾃｳrio oficial com todos os dados, scripts de processamento e documentaﾃｧﾃ｣o completa do projeto.</p>
                            <a href="https://github.com/transparencia-mg/despesa-pessoal-mg" 
                               target="_blank" 
                               class="btn-export">
                                <i class="material-icons">code</i> 
                                GitHub
                            </a>
                        </div>
                    </div>
                    
                    <!-- Card 4: Portal de Dados Abertos -->
                    <div class="col-md-6 col-12 mb-4">
                        <div class="card-stats">
                            <i class="material-icons">open_in_new</i>
                            <h4>Portal de Dados Abertos</h4>
                            <p>Acesse o portal oficial de dados abertos do Governo de Minas Gerais para mais informaﾃｧﾃｵes e outros datasets.</p>
                            <a href="https://dados.mg.gov.br/" 
                               target="_blank" 
                               class="btn-export">
                                <i class="material-icons">open_in_new</i> 
                                Acessar Portal
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Tabela de Estrutura dos Arquivos -->
                <div class="mt-5">
                    <h5 style="color: var(--primary-dark); font-weight: 600; margin-bottom: 15px; font-size: 16px;">
                        <i class="material-icons" style="vertical-align: middle; margin-right: 8px;">table_rows</i>
                        Estrutura dos Arquivos CSV
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-bordered" style="margin-bottom: 0;">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">Arquivo</th>
                                    <th style="width: 50%;">Descriﾃｧﾃ｣o</th>
                                    <th style="width: 20%;">Atualizaﾃｧﾃ｣o</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px;">despesa_pessoal_mensal.csv</code></td>
                                    <td>Dados mensais de despesa com pessoal (bruta, lﾃｭquida, ativo, inativos, deduﾃｧﾃｵes)</td>
                                    <td><span class="badge" style="background: var(--primary-dark); color: white; padding: 5px 10px;">Quadrimestral</span></td>
                                </tr>
                                <tr>
                                    <td><code style="background: #f8f9fa; padding: 4px 8px; border-radius: 4px;">limites_lrf.csv</code></td>
                                    <td>Limites da LRF por perﾃｭodo de 12 meses (RCL, deduﾃｧﾃｵes, DTP e percentuais)</td>
                                    <td><span class="badge" style="background: var(--primary-dark); color: white; padding: 5px 10px;">Quadrimestral</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Alertas Informativo e Legal -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="alert" style="background-color: rgba(23, 162, 184, 0.1); border: 1px solid var(--info-blue); border-radius: 8px; padding: 15px; margin-bottom: 0; height: 100%;">
                            <div style="display: flex; align-items: flex-start; gap: 12px;">
                                <i class="material-icons" style="font-size: 20px; color: var(--info-blue);">info</i>
                                <div>
                                    <strong style="color: var(--primary-dark);">Atualizaﾃｧﾃ｣o Automﾃ｡tica</strong>
                                    <p style="font-size: 12px; color: #6c757d; margin: 5px 0 0 0; line-height: 1.5;">
                                        Os dados sﾃ｣o sincronizados automaticamente via GitHub Actions quando novos arquivos sﾃ｣o publicados no repositﾃｳrio.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert" style="background-color: rgba(40, 167, 69, 0.1); border: 1px solid var(--success-green); border-radius: 8px; padding: 15px; margin-bottom: 0; height: 100%;">
                            <div style="display: flex; align-items: flex-start; gap: 12px;">
                                <i class="material-icons" style="font-size: 20px; color: var(--success-green);">balance</i>
                                <div>
                                    <strong style="color: var(--primary-dark);">Conformidade Legal</strong>
                                    <p style="font-size: 12px; color: #6c757d; margin: 5px 0 0 0; line-height: 1.5;">
                                        Dados elaborados conforme a Lei Complementar nﾂｺ 101/2000 (LRF) e publicados no RGF.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


    <!-- ==================== LOADING OVERLAY ==================== -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- ==================== SCRIPTS (ORDEM CORRETA) ==================== -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ============================================
        // VARIﾃ〃EIS GLOBAIS
        // ============================================
        let despesaMensalData = [];
        let limitesLRFData = [];
        let allData = {};
        let limitesData = {};
        let charts = {};
        let isAccumulated = false;

        // Variﾃ｡veis de estado
        let currentAnoDashboard1 = '';
        let currentPeriodoDashboard1 = 'mensal';
        let currentMesDashboard1 = '';
        let currentCategoriaDashboard1 = 'total';
        let currentAnoDashboard2 = '';
        let currentChartCategory = 'total';
        let currentPeriodoLRF = '';

        // URLs
        const GITHUB_BASE_URL = 'https://raw.githubusercontent.com/transparencia-mg/despesa-pessoal-mg/main/dataset/data/';
        const DESPESA_MENSAL_CSV = 'despesa_pessoal_mensal.csv';
        const LIMITES_LRF_CSV = 'limites_lrf.csv';

        // Cores dos grﾃ｡ficos
        const chartColors = {
            despesaBruta: '#29435A',
            pessoalAtivo: '#2F5D8A',
            vencimentos: '#4A7DAA',
            obrigacoesPatronais: '#2F7A5C',
            inativosPensionistas: '#6B5B95',
            despesasNaoComputadas: '#D97A30',
            despesaLiquida: '#20B2AA'
        };

        // ============================================
        // FUNﾃﾃ髭S DE COMPARTILHAMENTO
        // ============================================
        window.copiarLink = function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copiado para a ﾃ｡rea de transferﾃｪncia!');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = url;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Link copiado para a ﾃ｡rea de transferﾃｪncia!');
            });
            document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
        };

        window.compartilharFacebook = function(e) {
            e.preventDefault();
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`, '_blank');
            document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
        };

        window.compartilharTwitter = function(e) {
            e.preventDefault();
            window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent('Despesa com Pessoal - Governo de Minas Gerais')}`, '_blank');
            document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
        };

        window.compartilharLinkedIn = function(e) {
            e.preventDefault();
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(window.location.href)}`, '_blank');
            document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
        };

        window.compartilharWhatsApp = function(e) {
            e.preventDefault();
            window.open(`https://wa.me/?text=${encodeURIComponent('Despesa com Pessoal - Governo de Minas Gerais: ' + window.location.href)}`, '_blank');
            document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
        };

        // ============================================
        // FUNﾃﾃ髭S UTILITﾃヽIAS
        // ============================================
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.style.display = show ? 'flex' : 'none';
        }

        function showError(message) {
            const container = document.querySelector('.container');
            if (!container) return;
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger alert-dismissible fade show';
            errorDiv.innerHTML = `<i class="material-icons" style="font-size:16px;">error</i> ${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
            container.prepend(errorDiv);
        }

        function showSuccess(message) {
            const container = document.querySelector('.container');
            if (!container) return;
            const successDiv = document.createElement('div');
            successDiv.className = 'alert alert-success alert-dismissible fade show';
            successDiv.innerHTML = `<i class="material-icons" style="font-size:16px;">check_circle</i> ${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
            container.prepend(successDiv);
        }

        function parseNumber(value) {
            if (!value || value === ' -   ') return 0;
            return parseFloat(String(value).replace(/\./g, '').replace(',', '.')) || 0;
        }

        function formatCurrency(value, compact = false) {
            if (isNaN(value) || value === null || value === undefined) return 'R$ 0,00';
            if (compact && value >= 1e9) return `R$ ${(value / 1e9).toFixed(2).replace('.', ',')} bi`;
            if (compact && value >= 1e6) return `R$ ${(value / 1e6).toFixed(2).replace('.', ',')} mi`;
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function formatPercent(value) {
            if (isNaN(value)) return '0,00%';
            return `${value.toFixed(2).replace('.', ',')}%`;
        }

        function getMonthNumber(mesStr) {
            const meses = {
                'jan':1,'fev':2,'mar':3,'abr':4,'mai':5,'jun':6,
                'jul':7,'ago':8,'set':9,'out':10,'nov':11,'dez':12
            };
            return meses[mesStr?.toLowerCase()] || 0;
        }

        // ============================================
        // CARREGAMENTO DE DADOS
        // ============================================
        async function loadDespesaMensalData() {
            const url = `${GITHUB_BASE_URL}${DESPESA_MENSAL_CSV}`;
            console.log('Carregando despesa mensal:', url);
            
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                const result = Papa.parse(csvText, { delimiter: ';', header: true, skipEmptyLines: true });
                
                despesaMensalData = result.data.map(row => {
                    // Extrair mﾃｪs/ano da primeira coluna
                    const primeiraChave = Object.keys(row)[0];
                    const mesAnoRaw = row[primeiraChave] || '';
                    
                    let ano = '', mes = '', mesNum = 0, mesAnoFormatado = mesAnoRaw;
                    const match = mesAnoRaw.match(/([a-z]{3})-(\d{2})/i);
                    
                    if (match) {
                        const mesStr = match[1].toLowerCase();
                        const anoSufixo = match[2];
                        ano = `20${anoSufixo}`;
                        mesNum = getMonthNumber(mesStr);
                        mes = mesNum.toString().padStart(2, '0');
                        const monthNames = {1:'Jan',2:'Fev',3:'Mar',4:'Abr',5:'Mai',6:'Jun',7:'Jul',8:'Ago',9:'Set',10:'Out',11:'Nov',12:'Dez'};
                        mesAnoFormatado = `${monthNames[mesNum]}/${ano}`;
                    }

                    return {
                        mes_ano: mesAnoFormatado,
                        despesa_bruta: parseNumber(row.despesa_bruta_com_pessoal_i || row.despesa_bruta),
                        pessoal_ativo: parseNumber(row.pessoal_ativo),
                        vencimentos_vantagens: parseNumber(row.vencimentos_vantagens_e_outras_despesas_variaveis || row.vencimentos_vantagens),
                        obrigacoes_patronais: parseNumber(row.obrigacoes_patronais),
                        inativos_pensionistas: parseNumber(row.pessoal_inativo_e_pensionistas || row.inativos_pensionistas),
                        aposentadorias: parseNumber(row.aposentadorias_reserva_e_reformas || row.aposentadorias),
                        pensoes: parseNumber(row.pensoes),
                        despesas_nao_computadas: parseNumber(row.despesas_nao_computadas_ii_ss_1o_do_art_19_da_lrf || row.despesas_nao_computadas),
                        despesa_liquida: parseNumber(row.despesa_liquida_com_pessoal_iii_i_ii || row.despesa_liquida),
                        ANO: ano,
                        MES: mes,
                        MES_NUM: mesNum
                    };
                }).filter(item => item.ANO && item.despesa_bruta > 0);

                // Organizar por ano
                allData = {};
                despesaMensalData.forEach(item => {
                    if (!allData[item.ANO]) allData[item.ANO] = [];
                    allData[item.ANO].push(item);
                });
                
                Object.keys(allData).forEach(ano => {
                    allData[ano].sort((a, b) => a.MES_NUM - b.MES_NUM);
                });

                console.log('Despesa carregada. Anos:', Object.keys(allData));
                
            } catch (error) {
                console.error('Erro ao carregar despesa mensal:', error);
                despesaMensalData = [];
                allData = {};
            }
        }

        async function loadLimitesLRFData() {
            const url = `${GITHUB_BASE_URL}${LIMITES_LRF_CSV}`;
            console.log('Carregando limites LRF:', url);
            
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                const result = Papa.parse(csvText, { delimiter: ';', header: true, skipEmptyLines: true });
                
                limitesLRFData = result.data.map(row => {
                    return {
                        periodo: row['mes_ano_a_mes_ano'] || '',
                        rcl: parseNumber(row['receita_corrente_liquida_rcl_iv']),
                        transferencias_individuais: parseNumber(row['transferencias_obrigatorias_da_uniao_relativas_as_emendas_individuais_v_ss_1deg_art_166_da_cf']),
                        transferencias_bancada: parseNumber(row['transferencias_obrigatorias_da_uniao_relativas_as_emendas_de_bancada_art_166_ss_16_da_cf_vi']),
                        rcl_ajustada: parseNumber(row['receita_corrente_liquida_ajustada_para_calculo_dos_limites_da_despesa_com_pessoal_vii_iv_v_vi']),
                        despesa_total_pessoal: parseNumber(row['despesa_total_com_pessoal_dtp_sobre_a_rcl_vii_iii_a_iii_b']),
                        percentual_despesa: (parseNumber(row['despesa_total_com_pessoal_dtp_sobre_a_rcl_vii_iii_a_iii_b']) / parseNumber(row['receita_corrente_liquida_ajustada_para_calculo_dos_limites_da_despesa_com_pessoal_vii_iv_v_vi'])) * 100,
                        limite_maximo: 49.00,
                        limite_prudencial: 46.55,
                        limite_alerta: 44.10
                    };
                }).filter(item => item.periodo);

                limitesData = {};
                limitesLRFData.forEach(item => {
                    if (item.periodo) limitesData[item.periodo] = item;
                });

                console.log('Perﾃｭodos LRF carregados:', Object.keys(limitesData));
                
            } catch (error) {
                console.error('Erro ao carregar limites LRF:', error);
                limitesData = {};
            }
        }

        async function loadAllData() {
            showLoading(true);
            await loadDespesaMensalData();
            await loadLimitesLRFData();
            showLoading(false);
        }

        // ============================================
        // ATUALIZAﾃﾃグ DE FILTROS
        // ============================================
        function determineLatestData() {
            const anos = Object.keys(allData).sort((a, b) => b - a);
            currentAnoDashboard1 = anos[0] || '';
            currentAnoDashboard2 = anos[0] || '';
            
            if (currentAnoDashboard1 && allData[currentAnoDashboard1]?.length) {
                const ultimoMes = allData[currentAnoDashboard1][allData[currentAnoDashboard1].length - 1];
                currentMesDashboard1 = ultimoMes.mes_ano || '';
            }
            
            const periodos = Object.keys(limitesData).sort().reverse();
            currentPeriodoLRF = periodos[0] || '';
        }

        function updateFilterOptions() {
            const anos = Object.keys(allData).sort((a, b) => b - a);
            
            // Dashboard 1
            const anoSelect1 = document.getElementById('anoDashboard1');
            if (anoSelect1) {
                anoSelect1.innerHTML = anos.length 
                    ? anos.map(a => `<option value="${a}" ${a === currentAnoDashboard1 ? 'selected' : ''}>${a}</option>`).join('')
                    : '<option value="">Sem dados</option>';
            }
            
            updateMesOptions();
            
            // Dashboard 2
            const anoSelect2 = document.getElementById('anoDashboard2');
            if (anoSelect2) {
                anoSelect2.innerHTML = anos.length 
                    ? anos.map(a => `<option value="${a}" ${a === currentAnoDashboard2 ? 'selected' : ''}>${a}</option>`).join('')
                    : '<option value="">Sem dados</option>';
            }
            
            // Dashboard 3 - Perﾃｭodos LRF
            const periodoSelect = document.getElementById('periodoLRF');
            if (periodoSelect) {
                const periodos = Object.keys(limitesData).sort().reverse();
                if (periodos.length) {
                    periodoSelect.innerHTML = periodos.map(p => 
                        `<option value="${p}" ${p === currentPeriodoLRF ? 'selected' : ''}>${p}</option>`
                    ).join('');
                } else {
                    periodoSelect.innerHTML = '<option value="">Nenhum perﾃｭodo encontrado</option>';
                }
            }
            
            // Dashboard 4
            const anoDownload = document.getElementById('anoDownload');
            if (anoDownload) {
                anoDownload.innerHTML = anos.length 
                    ? anos.map(a => `<option value="${a}">${a}</option>`).join('')
                    : '<option value="">Sem dados</option>';
            }
        }

        function updateMesOptions() {
            const mesSelect = document.getElementById('mesDashboard1');
            if (mesSelect && currentAnoDashboard1 && allData[currentAnoDashboard1]) {
                const meses = allData[currentAnoDashboard1];
                mesSelect.innerHTML = meses.map(m => 
                    `<option value="${m.mes_ano}" ${m.mes_ano === currentMesDashboard1 ? 'selected' : ''}>${m.mes_ano}</option>`
                ).join('');
            }
        }

        function toggleMesVisibility() {
            const container = document.getElementById('mesDashboard1Container');
            if (container) {
                container.style.display = currentPeriodoDashboard1 === 'mensal' ? 'block' : 'none';
            }
        }

        // ============================================
        // DASHBOARD 1
        // ============================================
        function updateDashboard1() {
            if (Object.keys(allData).length === 0) return;
            
            const categoriaSelect = document.getElementById('categoriaDashboard1');
            if (categoriaSelect) currentCategoriaDashboard1 = categoriaSelect.value;
            
            updateSummaryCards();
            updateResumoTable();
            updateChartsDashboard1();
        }

        function updateSummaryCards() {
            const container = document.getElementById('summaryCards');
            if (!container) return;
            
            if (Object.keys(allData).length === 0) {
                container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">Nenhum dado encontrado.</p></div>';
                return;
            }
            
            let cardsHTML = '';
            
            if (currentPeriodoDashboard1 === 'anual') {
                const anoData = allData[currentAnoDashboard1] || [];
                if (anoData.length === 0) {
                    container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">Nenhum dado para o ano selecionado.</p></div>';
                    return;
                }
                
                const totalBruta = anoData.reduce((sum, item) => sum + item.despesa_bruta, 0);
                const totalAtivo = anoData.reduce((sum, item) => sum + item.pessoal_ativo, 0);
                const totalInativo = anoData.reduce((sum, item) => sum + item.inativos_pensionistas, 0);
                const mediaMensal = totalBruta / anoData.length;
                
                cardsHTML = `
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Despesa Bruta Anual</div>
                            <div class="metric-value">${formatCurrency(totalBruta, true)}</div>
                            <div><i class="material-icons" style="font-size: 12px;">calendar_today</i> ${currentAnoDashboard1}</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Pessoal Ativo (Anual)</div>
                            <div class="metric-value">${formatCurrency(totalAtivo, true)}</div>
                            <div class="metric-change positive">${formatPercent((totalAtivo/totalBruta)*100)} do total</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Inativos/Pensionistas</div>
                            <div class="metric-value">${formatCurrency(totalInativo, true)}</div>
                            <div class="metric-change warning">${formatPercent((totalInativo/totalBruta)*100)} do total</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Mﾃｩdia Mensal</div>
                            <div class="metric-value">${formatCurrency(mediaMensal, true)}</div>
                            <div class="metric-change positive">${anoData.length} meses</div>
                        </div>
                    </div>
                `;
            } else {
                const anoData = allData[currentAnoDashboard1] || [];
                const mesData = anoData.find(item => item.mes_ano === currentMesDashboard1);
                
                if (!mesData) {
                    container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">Nenhum dado para o mﾃｪs selecionado.</p></div>';
                    return;
                }
                
                cardsHTML = `
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Despesa Bruta</div>
                            <div class="metric-value">${formatCurrency(mesData.despesa_bruta, true)}</div>
                            <div><i class="material-icons" style="font-size: 12px;">calendar_today</i> ${currentMesDashboard1}</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Pessoal Ativo</div>
                            <div class="metric-value">${formatCurrency(mesData.pessoal_ativo, true)}</div>
                            <div class="metric-change positive">${formatPercent((mesData.pessoal_ativo/mesData.despesa_bruta)*100)} do total</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Inativos/Pensionistas</div>
                            <div class="metric-value">${formatCurrency(mesData.inativos_pensionistas, true)}</div>
                            <div class="metric-change warning">${formatPercent((mesData.inativos_pensionistas/mesData.despesa_bruta)*100)} do total</div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6">
                        <div class="metric-card">
                            <div class="metric-label">Despesa Lﾃｭquida</div>
                            <div class="metric-value">${formatCurrency(mesData.despesa_liquida, true)}</div>
                            <div class="metric-change positive">${formatPercent((mesData.despesa_liquida/mesData.despesa_bruta)*100)} da bruta</div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = cardsHTML;
        }

        function updateResumoTable() {
            const tbody = document.getElementById('resumoTableBody');
            const tfoot = document.getElementById('resumoTableFooter');
            const countElement = document.getElementById('resumoCountDashboard1');
            
            if (!tbody) return;
            
            if (Object.keys(allData).length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhum dado encontrado.</td></tr>';
                return;
            }
            
            if (currentPeriodoDashboard1 === 'anual') {
                const anoData = allData[currentAnoDashboard1] || [];
                if (anoData.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhum dado para o ano selecionado.</td></tr>';
                    return;
                }
                
                if (countElement) countElement.textContent = `Ano: ${currentAnoDashboard1}`;
                
                const totalBruta = anoData.reduce((s, i) => s + i.despesa_bruta, 0);
                const totalAtivo = anoData.reduce((s, i) => s + i.pessoal_ativo, 0);
                const totalVencimentos = anoData.reduce((s, i) => s + i.vencimentos_vantagens, 0);
                const totalObrigacoes = anoData.reduce((s, i) => s + i.obrigacoes_patronais, 0);
                const totalInativo = anoData.reduce((s, i) => s + i.inativos_pensionistas, 0);
                const totalAposentadorias = anoData.reduce((s, i) => s + i.aposentadorias, 0);
                const totalPensoes = anoData.reduce((s, i) => s + i.pensoes, 0);
                const totalNaoComputadas = anoData.reduce((s, i) => s + i.despesas_nao_computadas, 0);
                const totalLiquida = anoData.reduce((s, i) => s + i.despesa_liquida, 0);
                const meses = anoData.length;
                
                tbody.innerHTML = `
                    <tr><td><strong>DESPESA BRUTA COM PESSOAL</strong></td><td class="text-end valor-monetario"><strong>${formatCurrency(totalBruta)}</strong></td><td class="text-end"><strong>100.00%</strong></td><td class="text-end valor-monetario">${formatCurrency(totalBruta/meses)}</td></tr>
                    <tr><td style="padding-left:20px;">Pessoal Ativo</td><td class="text-end valor-monetario">${formatCurrency(totalAtivo)}</td><td class="text-end">${formatPercent((totalAtivo/totalBruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(totalAtivo/meses)}</td></tr>
                    <tr><td style="padding-left:40px;">Vencimentos e Vantagens</td><td class="text-end valor-monetario">${formatCurrency(totalVencimentos)}</td><td class="text-end">${formatPercent((totalVencimentos/totalBruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(totalVencimentos/meses)}</td></tr>
                    <tr><td style="padding-left:40px;">Obrigaﾃｧﾃｵes Patronais</td><td class="text-end valor-monetario">${formatCurrency(totalObrigacoes)}</td><td class="text-end">${formatPercent((totalObrigacoes/totalBruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(totalObrigacoes/meses)}</td></tr>
                    <tr><td style="padding-left:20px;">Pessoal Inativo e Pensionistas</td><td class="text-end valor-monetario">${formatCurrency(totalInativo)}</td><td class="text-end">${formatPercent((totalInativo/totalBruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(totalInativo/meses)}</td></tr>
                    <tr><td style="padding-left:40px;">Aposentadorias</td><td class="text-end valor-monetario">${formatCurrency(totalAposentadorias)}</td><td class="text-end">${formatPercent((totalAposentadorias/totalBruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(totalAposentadorias/meses)}</td></tr>
                    <tr><td style="padding-left:40px;">Pensﾃｵes</td><td class="text-end valor-monetario">${formatCurrency(totalPensoes)}</td><td class="text-end">${formatPercent((totalPensoes/totalBruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(totalPensoes/meses)}</td></tr>
                    <tr><td><strong>DESPESAS Nﾃグ COMPUTADAS</strong></td><td class="text-end valor-monetario valor-negativo"><strong>${formatCurrency(totalNaoComputadas)}</strong></td><td class="text-end valor-negativo"><strong>${formatPercent((totalNaoComputadas/totalBruta)*100)}</strong></td><td class="text-end valor-monetario valor-negativo">${formatCurrency(totalNaoComputadas/meses)}</td></tr>
                `;
                
                tfoot.innerHTML = `<tr class="table-total-row"><td><strong>DESPESA Lﾃ慌UIDA COM PESSOAL</strong></td><td class="text-end valor-monetario"><strong>${formatCurrency(totalLiquida)}</strong></td><td class="text-end"><strong>${formatPercent((totalLiquida/totalBruta)*100)}</strong></td><td class="text-end valor-monetario"><strong>${formatCurrency(totalLiquida/meses)}</strong></td></tr>`;
            } else {
                const anoData = allData[currentAnoDashboard1] || [];
                const mesData = anoData.find(item => item.mes_ano === currentMesDashboard1);
                
                if (!mesData) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhum dado para o mﾃｪs selecionado.</td></tr>';
                    return;
                }
                
                if (countElement) countElement.textContent = `Mﾃｪs: ${currentMesDashboard1}`;
                
                tbody.innerHTML = `
                    <tr><td><strong>DESPESA BRUTA COM PESSOAL</strong></td><td class="text-end valor-monetario"><strong>${formatCurrency(mesData.despesa_bruta)}</strong></td><td class="text-end"><strong>100.00%</strong></td><td class="text-end valor-monetario">${formatCurrency(mesData.despesa_bruta)}</td></tr>
                    <tr><td style="padding-left:20px;">Pessoal Ativo</td><td class="text-end valor-monetario">${formatCurrency(mesData.pessoal_ativo)}</td><td class="text-end">${formatPercent((mesData.pessoal_ativo/mesData.despesa_bruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(mesData.pessoal_ativo)}</td></tr>
                    <tr><td style="padding-left:40px;">Vencimentos e Vantagens</td><td class="text-end valor-monetario">${formatCurrency(mesData.vencimentos_vantagens)}</td><td class="text-end">${formatPercent((mesData.vencimentos_vantagens/mesData.despesa_bruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(mesData.vencimentos_vantagens)}</td></tr>
                    <tr><td style="padding-left:40px;">Obrigaﾃｧﾃｵes Patronais</td><td class="text-end valor-monetario">${formatCurrency(mesData.obrigacoes_patronais)}</td><td class="text-end">${formatPercent((mesData.obrigacoes_patronais/mesData.despesa_bruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(mesData.obrigacoes_patronais)}</td></tr>
                    <tr><td style="padding-left:20px;">Pessoal Inativo e Pensionistas</td><td class="text-end valor-monetario">${formatCurrency(mesData.inativos_pensionistas)}</td><td class="text-end">${formatPercent((mesData.inativos_pensionistas/mesData.despesa_bruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(mesData.inativos_pensionistas)}</td></tr>
                    <tr><td style="padding-left:40px;">Aposentadorias</td><td class="text-end valor-monetario">${formatCurrency(mesData.aposentadorias)}</td><td class="text-end">${formatPercent((mesData.aposentadorias/mesData.despesa_bruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(mesData.aposentadorias)}</td></tr>
                    <tr><td style="padding-left:40px;">Pensﾃｵes</td><td class="text-end valor-monetario">${formatCurrency(mesData.pensoes)}</td><td class="text-end">${formatPercent((mesData.pensoes/mesData.despesa_bruta)*100)}</td><td class="text-end valor-monetario">${formatCurrency(mesData.pensoes)}</td></tr>
                    <tr><td><strong>DESPESAS Nﾃグ COMPUTADAS</strong></td><td class="text-end valor-monetario valor-negativo"><strong>${formatCurrency(mesData.despesas_nao_computadas)}</strong></td><td class="text-end valor-negativo"><strong>${formatPercent((mesData.despesas_nao_computadas/mesData.despesa_bruta)*100)}</strong></td><td class="text-end valor-monetario valor-negativo">${formatCurrency(mesData.despesas_nao_computadas)}</td></tr>
                `;
                
                tfoot.innerHTML = `<tr class="table-total-row"><td><strong>DESPESA Lﾃ慌UIDA COM PESSOAL</strong></td><td class="text-end valor-monetario"><strong>${formatCurrency(mesData.despesa_liquida)}</strong></td><td class="text-end"><strong>${formatPercent((mesData.despesa_liquida/mesData.despesa_bruta)*100)}</strong></td><td class="text-end valor-monetario"><strong>${formatCurrency(mesData.despesa_liquida)}</strong></td></tr>`;
            }
        }

        function updateChartsDashboard1() {
            updateDistribuicaoChart();
            updateAtivoDetalhadoChart();
        }

        function updateDistribuicaoChart() {
            const ctx = document.getElementById('chartDistribuicao')?.getContext('2d');
            if (!ctx) return;
            
            let data = [], labels = [], colors = [];
            
            if (currentPeriodoDashboard1 === 'anual') {
                const anoData = allData[currentAnoDashboard1] || [];
                if (anoData.length === 0) return;
                
                const totalAtivo = anoData.reduce((s, i) => s + i.pessoal_ativo, 0);
                const totalInativo = anoData.reduce((s, i) => s + i.inativos_pensionistas, 0);
                const totalNaoComputadas = anoData.reduce((s, i) => s + i.despesas_nao_computadas, 0);
                const totalBruta = anoData.reduce((s, i) => s + i.despesa_bruta, 0);
                const outros = Math.max(0, totalBruta - totalAtivo - totalInativo - totalNaoComputadas);
                
                data = [totalAtivo, totalInativo, totalNaoComputadas, outros];
                labels = ['Pessoal Ativo', 'Inativos/Pensionistas', 'Nﾃ｣o Computadas', 'Outras'];
                colors = [chartColors.pessoalAtivo, chartColors.inativosPensionistas, chartColors.despesasNaoComputadas, '#6C7A89'];
            } else {
                const anoData = allData[currentAnoDashboard1] || [];
                const mesData = anoData.find(item => item.mes_ano === currentMesDashboard1);
                if (!mesData) return;
                
                const outros = Math.max(0, mesData.despesa_bruta - mesData.pessoal_ativo - mesData.inativos_pensionistas - mesData.despesas_nao_computadas);
                data = [mesData.pessoal_ativo, mesData.inativos_pensionistas, mesData.despesas_nao_computadas, outros];
                labels = ['Pessoal Ativo', 'Inativos/Pensionistas', 'Nﾃ｣o Computadas', 'Outras'];
                colors = [chartColors.pessoalAtivo, chartColors.inativosPensionistas, chartColors.despesasNaoComputadas, '#6C7A89'];
            }
            
            if (charts.distribuicao) charts.distribuicao.destroy();
            
            charts.distribuicao = new Chart(ctx, {
                type: 'doughnut',
                data: { labels, datasets: [{ data, backgroundColor: colors, borderWidth: 2, borderColor: '#fff' }] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true, font: { size: 10 } } },
                        tooltip: { callbacks: { label: (ctx) => `${ctx.label}: ${formatCurrency(ctx.raw, true)} (${Math.round((ctx.raw / ctx.dataset.data.reduce((a,b) => a+b,0)) * 100)}%)` } }
                    }
                }
            });
        }

        function updateAtivoDetalhadoChart() {
            const ctx = document.getElementById('chartAtivoDetalhado')?.getContext('2d');
            if (!ctx) return;
            
            let vencimentos = [], obrigacoes = [], label = '';
            
            if (currentPeriodoDashboard1 === 'anual') {
                const anoData = allData[currentAnoDashboard1] || [];
                if (anoData.length === 0) return;
                vencimentos = [anoData.reduce((s, i) => s + i.vencimentos_vantagens, 0)];
                obrigacoes = [anoData.reduce((s, i) => s + i.obrigacoes_patronais, 0)];
                label = `Ano ${currentAnoDashboard1}`;
            } else {
                const anoData = allData[currentAnoDashboard1] || [];
                const mesData = anoData.find(item => item.mes_ano === currentMesDashboard1);
                if (!mesData) return;
                vencimentos = [mesData.vencimentos_vantagens];
                obrigacoes = [mesData.obrigacoes_patronais];
                label = currentMesDashboard1;
            }
            
            if (charts.ativoDetalhado) charts.ativoDetalhado.destroy();
            
            charts.ativoDetalhado = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [label],
                    datasets: [
                        { label: 'Vencimentos e Vantagens', data: vencimentos, backgroundColor: chartColors.vencimentos, borderColor: chartColors.vencimentos, borderWidth: 1 },
                        { label: 'Obrigaﾃｧﾃｵes Patronais', data: obrigacoes, backgroundColor: chartColors.obrigacoesPatronais, borderColor: chartColors.obrigacoesPatronais, borderWidth: 1 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, ticks: { callback: (v) => formatCurrency(v, true), font: { size: 10 } } } },
                    plugins: { legend: { position: 'bottom', labels: { padding: 15, usePointStyle: true, font: { size: 10 } } } }
                }
            });
        }

        // ============================================
        // DASHBOARD 2
        // ============================================
        function updateDashboard2() {
            const anoSelect = document.getElementById('anoDashboard2');
            const categoriaSelect = document.getElementById('categoriaDashboard2');
            
            if (anoSelect) currentAnoDashboard2 = anoSelect.value;
            if (categoriaSelect) currentChartCategory = categoriaSelect.value;
            
            updateEvolucaoChart();
            updateEvolucaoTable();
        }

        function updateEvolucaoChart() {
            const ctx = document.getElementById('chartEvolucao')?.getContext('2d');
            if (!ctx) return;
            
            const anoData = allData[currentAnoDashboard2] || [];
            if (anoData.length === 0) return;
            
            let datasetData = [], datasetLabel = '', datasetColor = '';
            const labels = anoData.map(item => item.mes_ano);
            
            switch(currentChartCategory) {
                case 'total':
                case 'bruta':
                    datasetData = anoData.map(item => item.despesa_bruta);
                    datasetLabel = currentChartCategory === 'total' ? 'Despesa Bruta Total' : 'Despesa Bruta';
                    datasetColor = chartColors.despesaBruta;
                    break;
                case 'liquida':
                    datasetData = anoData.map(item => item.despesa_liquida);
                    datasetLabel = 'Despesa Lﾃｭquida';
                    datasetColor = chartColors.despesaLiquida;
                    break;
                case 'ativo':
                    datasetData = anoData.map(item => item.pessoal_ativo);
                    datasetLabel = 'Pessoal Ativo';
                    datasetColor = chartColors.pessoalAtivo;
                    break;
                case 'inativo':
                    datasetData = anoData.map(item => item.inativos_pensionistas);
                    datasetLabel = 'Inativos/Pensionistas';
                    datasetColor = chartColors.inativosPensionistas;
                    break;
            }
            
            if (isAccumulated) {
                let acumulado = 0;
                datasetData = datasetData.map(v => acumulado += v);
                datasetLabel += ' (Acumulado)';
            }
            
            if (charts.evolucao) charts.evolucao.destroy();
            
            charts.evolucao = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: datasetLabel,
                        data: datasetData,
                        backgroundColor: datasetColor + '20',
                        borderColor: datasetColor,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: !isAccumulated,
                            ticks: { callback: (v) => formatCurrency(v, true), font: { size: 10 } }
                        }
                    },
                    plugins: {
                        tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${formatCurrency(ctx.raw)}` } }
                    }
                }
            });
        }

        function updateEvolucaoTable() {
            const tbody = document.getElementById('evolucaoTableBody');
            const countElement = document.getElementById('resumoCountDashboard2');
            
            if (countElement) countElement.textContent = `Ano: ${currentAnoDashboard2}`;
            
            const anoData = allData[currentAnoDashboard2] || [];
            if (anoData.length === 0) {
                if (tbody) tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Nenhum dado para o ano selecionado.</td></tr>';
                return;
            }
            
            let rowsHTML = '';
            for (let i = 0; i < anoData.length; i++) {
                const item = anoData[i];
                let variacao = '-';
                if (i > 0 && anoData[i-1].despesa_bruta > 0) {
                    const perc = ((item.despesa_bruta - anoData[i-1].despesa_bruta) / anoData[i-1].despesa_bruta) * 100;
                    variacao = `${perc.toFixed(2).replace('.', ',')}%`;
                }
                rowsHTML += `<tr>
                    <td>${item.mes_ano}</td>
                    <td class="text-end valor-monetario">${formatCurrency(item.despesa_bruta, true)}</td>
                    <td class="text-end valor-monetario">${formatCurrency(item.despesa_liquida, true)}</td>
                    <td class="text-end valor-monetario">${formatCurrency(item.pessoal_ativo, true)}</td>
                    <td class="text-end valor-monetario">${formatCurrency(item.inativos_pensionistas, true)}</td>
                    <td class="text-end ${variacao !== '-' && parseFloat(variacao) >= 0 ? 'valor-positivo' : 'valor-negativo'}">${variacao}</td>
                </tr>`;
            }
            
            if (tbody) tbody.innerHTML = rowsHTML;
        }

        // ============================================
        // DASHBOARD 3 - LIMITES LRF
        // ============================================
        function updateDashboard3() {
            const periodoSelect = document.getElementById('periodoLRF');
            if (!periodoSelect) return;
            
            currentPeriodoLRF = periodoSelect.value;
            if (!currentPeriodoLRF) return;
            
            const data = limitesData[currentPeriodoLRF];
            if (!data) return;

            // Atualizar cards de percentuais
            document.getElementById('limiteLegalPercentual').textContent = `${data.limite_maximo.toFixed(2).replace('.', ',')}%`;
            document.getElementById('limitePrudencialPercentual').textContent = `${data.limite_prudencial.toFixed(2).replace('.', ',')}%`;
            document.getElementById('limiteAlertaPercentual').textContent = `${data.limite_alerta.toFixed(2).replace('.', ',')}%`;

            // Atualizar valores em R$ dos limites
            document.getElementById('limiteLegalValor').textContent = formatCurrency(data.rcl_ajustada * (data.limite_maximo/100), true);
            document.getElementById('limitePrudencialValor').textContent = formatCurrency(data.rcl_ajustada * (data.limite_prudencial/100), true);
            document.getElementById('limiteAlertaValor').textContent = formatCurrency(data.rcl_ajustada * (data.limite_alerta/100), true);

            // Atualizar labels na barra de progresso
            document.getElementById('limiteLegalValorLabel').textContent = `${data.limite_maximo.toFixed(2).replace('.', ',')}%`;
            document.getElementById('limitePrudencialValorLabel').textContent = `${data.limite_prudencial.toFixed(2).replace('.', ',')}%`;
            document.getElementById('limiteAlertaValorLabel').textContent = `${data.limite_alerta.toFixed(2).replace('.', ',')}%`;

            // Atualizar barra de progresso
            const percentual = data.percentual_despesa || 0;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${percentual}%`;
            document.getElementById('despesaAtualPercentual').textContent = `${percentual.toFixed(2).replace('.', ',')}%`;

            // Atualizar RCL e Despesa
            document.getElementById('rclTotal').textContent = formatCurrency(data.rcl_ajustada, true);
            document.getElementById('despesaExecutada').textContent = formatCurrency(data.despesa_total_pessoal, true);

            // Atualizar cor da barra
            updateProgressBarColor(percentual, data.limite_alerta, data.limite_prudencial, data.limite_maximo);

            // Tabela detalhada
            const tbody = document.getElementById('limitesTableBody');
            tbody.innerHTML = `
                <tr>
                    <td><strong>Receita Corrente Lﾃｭquida (RCL)</strong></td>
                    <td class="text-end valor-monetario valor-positivo">${formatCurrency(data.rcl)}</td>
                    <td class="text-end">100.00%</td>
                </tr>
                <tr>
                    <td>(-) Transferﾃｪncias da Uniﾃ｣o - Emendas Individuais</td>
                    <td class="text-end valor-monetario valor-negativo">${formatCurrency(data.transferencias_individuais)}</td>
                    <td class="text-end">${formatPercent((data.transferencias_individuais/data.rcl)*100)}</td>
                </tr>
                <tr>
                    <td>(-) Transferﾃｪncias da Uniﾃ｣o - Emendas de Bancada</td>
                    <td class="text-end valor-monetario valor-negativo">${formatCurrency(data.transferencias_bancada)}</td>
                    <td class="text-end">${formatPercent((data.transferencias_bancada/data.rcl)*100)}</td>
                </tr>
                <tr class="table-total-row">
                    <td><strong>RECEITA CORRENTE Lﾃ慌UIDA AJUSTADA</strong></td>
                    <td class="text-end valor-monetario valor-positivo"><strong>${formatCurrency(data.rcl_ajustada)}</strong></td>
                    <td class="text-end"><strong>100.00%</strong></td>
                </tr>
                <tr>
                    <td><strong>DESPESA TOTAL COM PESSOAL (DTP)</strong></td>
                    <td class="text-end valor-monetario"><strong>${formatCurrency(data.despesa_total_pessoal)}</strong></td>
                    <td class="text-end"><strong>${formatPercent(data.percentual_despesa)}</strong></td>
                </tr>
                <tr>
                    <td style="padding-left:20px;">Limite Legal (49.00% da RCL Ajustada)</td>
                    <td class="text-end valor-monetario valor-positivo">${formatCurrency(data.rcl_ajustada * 0.49)}</td>
                    <td class="text-end">49.00%</td>
                </tr>
                <tr>
                    <td style="padding-left:20px;">Limite Prudencial (46.55% da RCL Ajustada)</td>
                    <td class="text-end valor-monetario valor-positivo">${formatCurrency(data.rcl_ajustada * 0.4655)}</td>
                    <td class="text-end">46.55%</td>
                </tr>
                <tr>
                    <td style="padding-left:20px;">Limite de Alerta (44.10% da RCL Ajustada)</td>
                    <td class="text-end valor-monetario valor-positivo">${formatCurrency(data.rcl_ajustada * 0.441)}</td>
                    <td class="text-end">44.10%</td>
                </tr>
            `;
        }

        function updateProgressBarColor(percentual, limiteAlerta, limitePrudencial, limiteMaximo) {
            const bar = document.getElementById('progressBar');
            const legalCard = document.getElementById('limiteLegalCard');
            const prudCard = document.getElementById('limitePrudencialCard');
            const alertCard = document.getElementById('limiteAlertaCard');
            
            if (!bar) return;
            
            if (percentual <= limiteAlerta) {
                bar.className = 'progress-bar-limite safe';
                legalCard.className = 'limite-card safe';
                prudCard.className = 'limite-card safe';
                alertCard.className = 'limite-card safe';
            } else if (percentual <= limitePrudencial) {
                bar.className = 'progress-bar-limite warning';
                legalCard.className = 'limite-card safe';
                prudCard.className = 'limite-card warning';
                alertCard.className = 'limite-card warning';
            } else if (percentual <= limiteMaximo) {
                bar.className = 'progress-bar-limite danger';
                legalCard.className = 'limite-card warning';
                prudCard.className = 'limite-card danger';
                alertCard.className = 'limite-card danger';
            } else {
                bar.className = 'progress-bar-limite danger';
                legalCard.className = 'limite-card danger';
                prudCard.className = 'limite-card danger';
                alertCard.className = 'limite-card danger';
            }
        }

        // ============================================
        // FUNﾃﾃ髭S DE EXPORTAﾃﾃグ E DOWNLOAD
        // ============================================
        function exportDashboard1CSV() {
            let headers = ['Descriﾃｧﾃ｣o', 'Valor (R$)', '% do Total', 'Mﾃｩdia Mensal'];
            let rows = [], filename = '';
            
            if (currentPeriodoDashboard1 === 'anual') {
                const anoData = allData[currentAnoDashboard1] || [];
                if (anoData.length === 0) { alert('Nenhum dado disponﾃｭvel.'); return; }
                
                const totalBruta = anoData.reduce((s, i) => s + i.despesa_bruta, 0);
                const totalAtivo = anoData.reduce((s, i) => s + i.pessoal_ativo, 0);
                const totalVencimentos = anoData.reduce((s, i) => s + i.vencimentos_vantagens, 0);
                const totalObrigacoes = anoData.reduce((s, i) => s + i.obrigacoes_patronais, 0);
                const totalInativo = anoData.reduce((s, i) => s + i.inativos_pensionistas, 0);
                const totalAposentadorias = anoData.reduce((s, i) => s + i.aposentadorias, 0);
                const totalPensoes = anoData.reduce((s, i) => s + i.pensoes, 0);
                const totalNaoComputadas = anoData.reduce((s, i) => s + i.despesas_nao_computadas, 0);
                const totalLiquida = anoData.reduce((s, i) => s + i.despesa_liquida, 0);
                const meses = anoData.length;
                
                rows = [
                    ['DESPESA BRUTA COM PESSOAL', totalBruta, '100.00', totalBruta/meses],
                    ['Pessoal Ativo', totalAtivo, ((totalAtivo/totalBruta)*100).toFixed(2), totalAtivo/meses],
                    ['Vencimentos, Vantagens', totalVencimentos, ((totalVencimentos/totalBruta)*100).toFixed(2), totalVencimentos/meses],
                    ['Obrigaﾃｧﾃｵes Patronais', totalObrigacoes, ((totalObrigacoes/totalBruta)*100).toFixed(2), totalObrigacoes/meses],
                    ['Pessoal Inativo e Pensionistas', totalInativo, ((totalInativo/totalBruta)*100).toFixed(2), totalInativo/meses],
                    ['Aposentadorias', totalAposentadorias, ((totalAposentadorias/totalBruta)*100).toFixed(2), totalAposentadorias/meses],
                    ['Pensﾃｵes', totalPensoes, ((totalPensoes/totalBruta)*100).toFixed(2), totalPensoes/meses],
                    ['DESPESAS Nﾃグ COMPUTADAS', totalNaoComputadas, ((totalNaoComputadas/totalBruta)*100).toFixed(2), totalNaoComputadas/meses],
                    ['DESPESA Lﾃ慌UIDA COM PESSOAL', totalLiquida, ((totalLiquida/totalBruta)*100).toFixed(2), totalLiquida/meses]
                ];
                filename = `despesa_pessoal_anual_${currentAnoDashboard1}.csv`;
            } else {
                const anoData = allData[currentAnoDashboard1] || [];
                const mesData = anoData.find(item => item.mes_ano === currentMesDashboard1);
                if (!mesData) { alert('Nenhum dado disponﾃｭvel.'); return; }
                
                rows = [
                    ['DESPESA BRUTA COM PESSOAL', mesData.despesa_bruta, '100.00', mesData.despesa_bruta],
                    ['Pessoal Ativo', mesData.pessoal_ativo, ((mesData.pessoal_ativo/mesData.despesa_bruta)*100).toFixed(2), mesData.pessoal_ativo],
                    ['Vencimentos, Vantagens', mesData.vencimentos_vantagens, ((mesData.vencimentos_vantagens/mesData.despesa_bruta)*100).toFixed(2), mesData.vencimentos_vantagens],
                    ['Obrigaﾃｧﾃｵes Patronais', mesData.obrigacoes_patronais, ((mesData.obrigacoes_patronais/mesData.despesa_bruta)*100).toFixed(2), mesData.obrigacoes_patronais],
                    ['Pessoal Inativo e Pensionistas', mesData.inativos_pensionistas, ((mesData.inativos_pensionistas/mesData.despesa_bruta)*100).toFixed(2), mesData.inativos_pensionistas],
                    ['Aposentadorias', mesData.aposentadorias, ((mesData.aposentadorias/mesData.despesa_bruta)*100).toFixed(2), mesData.aposentadorias],
                    ['Pensﾃｵes', mesData.pensoes, ((mesData.pensoes/mesData.despesa_bruta)*100).toFixed(2), mesData.pensoes],
                    ['DESPESAS Nﾃグ COMPUTADAS', mesData.despesas_nao_computadas, ((mesData.despesas_nao_computadas/mesData.despesa_bruta)*100).toFixed(2), mesData.despesas_nao_computadas],
                    ['DESPESA Lﾃ慌UIDA COM PESSOAL', mesData.despesa_liquida, ((mesData.despesa_liquida/mesData.despesa_bruta)*100).toFixed(2), mesData.despesa_liquida]
                ];
                filename = `despesa_pessoal_mensal_${currentMesDashboard1.replace('/', '_')}.csv`;
            }
            
            const csvContent = [headers.join(';'), ...rows.map(row => row.map(cell => `"${cell}"`).join(';'))].join('\n');
            downloadCSV(csvContent, filename);
        }

        function exportDashboard2CSV() {
            const headers = ['Mﾃｪs', 'Despesa Bruta', 'Despesa Lﾃｭquida', 'Pessoal Ativo', 'Inativos/Pensionistas', 'Variaﾃｧﾃ｣o %'];
            const rows = [];
            
            const anoData = allData[currentAnoDashboard2] || [];
            if (anoData.length === 0) { alert('Nenhum dado disponﾃｭvel.'); return; }
            
            for (let i = 0; i < anoData.length; i++) {
                const item = anoData[i];
                let variacao = '';
                if (i > 0 && anoData[i-1].despesa_bruta > 0) {
                    variacao = (((item.despesa_bruta - anoData[i-1].despesa_bruta) / anoData[i-1].despesa_bruta) * 100).toFixed(2);
                }
                rows.push([item.mes_ano, item.despesa_bruta, item.despesa_liquida, item.pessoal_ativo, item.inativos_pensionistas, variacao]);
            }
            
            const csvContent = [headers.join(';'), ...rows.map(row => row.map(cell => `"${cell}"`).join(';'))].join('\n');
            downloadCSV(csvContent, `evolucao_despesa_${currentAnoDashboard2}.csv`);
        }

        function downloadQuadrimestreCSV() {
            const ano = document.getElementById('anoDownload')?.value;
            const quad = document.getElementById('quadrimestreDownload')?.value;
            
            if (!ano || !allData[ano]) {
                alert('Selecione um ano vﾃ｡lido.');
                return;
            }
            
            const mesesMap = { '1': [1,2,3,4], '2': [5,6,7,8], '3': [9,10,11,12] };
            const mesesFiltro = mesesMap[quad] || [];
            const dadosFiltrados = allData[ano].filter(d => mesesFiltro.includes(d.MES_NUM));
            
            if (dadosFiltrados.length === 0) {
                alert('Nenhum dado encontrado para o perﾃｭodo selecionado.');
                return;
            }
            
            const headers = ['mes_ano', 'despesa_bruta', 'pessoal_ativo', 'vencimentos_vantagens', 
                           'obrigacoes_patronais', 'inativos_pensionistas', 'aposentadorias', 
                           'pensoes', 'despesas_nao_computadas', 'despesa_liquida'];
            
            const rows = dadosFiltrados.map(item => headers.map(h => item[h] || ''));
            
            const csvContent = [headers.join(';'), ...rows.map(row => row.map(cell => `"${cell}"`).join(';'))].join('\n');
            
            const nomeQuadrimestre = { '1': '1_quadrimestre', '2': '2_quadrimestre', '3': '3_quadrimestre' }[quad] || 'quadrimestre';
            downloadCSV(csvContent, `despesa_pessoal_${ano}_${nomeQuadrimestre}.csv`);
        }

        function downloadCSV(content, filename) {
            try {
                const blob = new Blob(["\ufeff" + content], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.href = url;
                link.download = filename;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Erro ao baixar CSV:', error);
                alert('Erro ao baixar o arquivo.');
            }
        }

        function printDashboard1() { window.print(); }
        function printDashboard2() { window.print(); }

        // ============================================
        // RESET DE FILTROS
        // ============================================
        function resetFiltersDashboard1() {
            const anos = Object.keys(allData).sort((a, b) => b - a);
            currentAnoDashboard1 = anos[0] || '';
            currentPeriodoDashboard1 = 'mensal';
            
            if (currentAnoDashboard1 && allData[currentAnoDashboard1]?.length) {
                currentMesDashboard1 = allData[currentAnoDashboard1][allData[currentAnoDashboard1].length - 1].mes_ano;
            }
            
            const periodoSelect = document.getElementById('periodoDashboard1');
            if (periodoSelect) periodoSelect.value = 'mensal';
            
            toggleMesVisibility();
            updateFilterOptions();
            updateDashboard1();
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Dashboard 1
            document.getElementById('aplicarFiltros')?.addEventListener('click', updateDashboard1);
            document.getElementById('limparFiltros')?.addEventListener('click', resetFiltersDashboard1);
            document.getElementById('anoDashboard1')?.addEventListener('change', function(e) {
                currentAnoDashboard1 = e.target.value;
                updateMesOptions();
                updateDashboard1();
            });
            document.getElementById('periodoDashboard1')?.addEventListener('change', function(e) {
                currentPeriodoDashboard1 = e.target.value;
                toggleMesVisibility();
                updateDashboard1();
            });
            document.getElementById('mesDashboard1')?.addEventListener('change', function(e) {
                currentMesDashboard1 = e.target.value;
                updateDashboard1();
            });
            
            // Dashboard 2
            document.getElementById('aplicarFiltrosDashboard2')?.addEventListener('click', updateDashboard2);
            document.getElementById('anoDashboard2')?.addEventListener('change', function(e) {
                currentAnoDashboard2 = e.target.value;
                updateDashboard2();
            });
            document.getElementById('categoriaDashboard2')?.addEventListener('change', updateDashboard2);
            document.getElementById('toggleAccumulated')?.addEventListener('change', function(e) {
                isAccumulated = e.target.checked;
                updateEvolucaoChart();
            });
            
            // Dashboard 3
            document.getElementById('periodoLRF')?.addEventListener('change', updateDashboard3);
            
            // Dashboard 4
            document.getElementById('downloadQuadrimestreCSV')?.addEventListener('click', downloadQuadrimestreCSV);
            
            // Botﾃｵes de exportaﾃｧﾃ｣o
            document.getElementById('exportCSVDashboard1')?.addEventListener('click', exportDashboard1CSV);
            document.getElementById('exportCSVDashboard2')?.addEventListener('click', exportDashboard2CSV);
            document.getElementById('printDashboard1')?.addEventListener('click', printDashboard1);
            document.getElementById('printDashboard2')?.addEventListener('click', printDashboard2);
            
            // Compartilhamento
            const shareButton1 = document.getElementById('shareButton1');
            const shareButton2 = document.getElementById('shareButton2');
            const shareOptions1 = document.getElementById('shareOptions1');
            const shareOptions2 = document.getElementById('shareOptions2');
            
            function toggleShareOptions(btn, opts) {
                btn?.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isShow = opts.classList.contains('show');
                    document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
                    if (!isShow) opts.classList.add('show');
                });
            }
            
            toggleShareOptions(shareButton1, shareOptions1);
            toggleShareOptions(shareButton2, shareOptions2);
            
            document.addEventListener('click', () => {
                document.querySelectorAll('.share-options').forEach(o => o.classList.remove('show'));
            });
        }

        // ============================================
        // INICIALIZAﾃﾃグ
        // ============================================
        async function init() {
            console.log('=== INICIANDO DASHBOARD DESPESA COM PESSOAL ===');
            showLoading(true);
            
            try {
                await loadAllData();
                determineLatestData();
                
                // Atualizar data
                const now = new Date();
                const dataFormatada = now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR');
                const dataHeader = document.getElementById('data-atualizacao-header');
                const dataFooter = document.getElementById('footer-atualizacao');
                if (dataHeader) dataHeader.textContent = dataFormatada;
                if (dataFooter) dataFooter.textContent = dataFormatada;
                
                updateFilterOptions();
                toggleMesVisibility();
                updateDashboard1();
                updateDashboard2();
                
                if (Object.keys(limitesData).length > 0) {
                    updateDashboard3();
                }
                
                setupEventListeners();
                
                console.log('Dashboard inicializado com sucesso!');
                console.log(`Registros de despesa: ${despesaMensalData.length}`);
                console.log(`Perﾃｭodos LRF: ${Object.keys(limitesData).length}`);
                
            } catch (error) {
                console.error('Erro na inicializaﾃｧﾃ｣o:', error);
                showError('Erro ao carregar dados. Por favor, recarregue a pﾃ｡gina.');
            } finally {
                showLoading(false);
            }
        }

        // Iniciar tudo quando a pﾃ｡gina carregar
        init();
    </script>
</body>
</html>
